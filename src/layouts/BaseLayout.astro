---
import { configuracion } from '../stores/company.store';
import InitStores from '../components/InitStores';
const { title = 'Sistema Contable' } = Astro.props;
const cfg = configuracion.get();
const companyName = cfg.infoLegal?.entidad || 'Entidad';
const companyNit = cfg.infoLegal?.nit || 'N/A';
import '../styles/globals.css';

// Detectar página actual para resaltar en nav
const currentPath = Astro.url.pathname;
const year = new Date().getFullYear();
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
  </head>
  <body
    class="min-h-screen bg-linear-to-br from-violet-50 via-purple-50 to-fuchsia-50 text-gray-900 flex flex-col"
  >
    <header
      class="fixed top-0 left-0 right-0 z-30 border-b-2 border-brand-200 bg-white shadow-md"
    >
      <div
        class="max-w-7xl mx-auto px-4 md:px-8 h-16 flex items-center justify-between"
      >
        <a
          href="/"
          class="flex items-center gap-2 font-bold text-lg text-brand-700 hover:text-brand-800 transition-colors group"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="group-hover:scale-110 transition-transform"
          >
            <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z"></path>
            <path d="m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9"
            ></path>
            <path d="M12 3v6"></path>
          </svg>
          <span>{companyName}</span>
        </a>
        <nav
          class="hidden md:flex items-center gap-1 text-sm font-medium"
          role="navigation"
          aria-label="Navegación principal"
        >
          <a
            class={`px-4 py-2 rounded-lg transition-all ${
              currentPath === '/'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100 hover:text-brand-600'
            }`}
            href="/"
            aria-current={currentPath === '/' ? 'page' : undefined}
          >
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              Inicio
            </span>
          </a>
          <a
            class={`px-4 py-2 rounded-lg transition-all ${
              currentPath === '/asientos'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100 hover:text-brand-600'
            }`}
            href="/asientos"
            aria-current={currentPath === '/asientos' ? 'page' : undefined}
          >
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
                ></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" x2="8" y1="13" y2="13"></line>
                <line x1="16" x2="8" y1="17" y2="17"></line>
                <line x1="10" x2="8" y1="9" y2="9"></line>
              </svg>
              Asientos
            </span>
          </a>
          <a
            class={`px-4 py-2 rounded-lg transition-all ${
              currentPath === '/reportes'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100 hover:text-brand-600'
            }`}
            href="/reportes"
            aria-current={currentPath === '/reportes' ? 'page' : undefined}
          >
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="12" x2="12" y1="20" y2="10"></line>
                <line x1="18" x2="18" y1="20" y2="4"></line>
                <line x1="6" x2="6" y1="20" y2="16"></line>
              </svg>
              Reportes
            </span>
          </a>
          <a
            class={`px-4 py-2 rounded-lg transition-all ${
              currentPath === '/compras'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100 hover:text-brand-600'
            }`}
            href="/compras"
            aria-current={currentPath === '/compras' ? 'page' : undefined}
          >
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path
                  d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
                ></path>
              </svg>
              Compras
            </span>
          </a>
          <a
            class={`px-4 py-2 rounded-lg transition-all ${
              currentPath === '/libro-diario'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100 hover:text-brand-600'
            }`}
            href="/libro-diario"
            aria-current={currentPath === '/libro-diario' ? 'page' : undefined}
          >
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"
                ></path>
              </svg>
              Libro Diario
            </span>
          </a>
          <a
            class={`px-4 py-2 rounded-lg transition-all ${
              currentPath === '/libro-mayor'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100 hover:text-brand-600'
            }`}
            href="/libro-mayor"
            aria-current={currentPath === '/libro-mayor' ? 'page' : undefined}
          >
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
              Libro Mayor
            </span>
          </a>
          <a
            href="/api/logout"
            class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-fuchsia-600 hover:bg-fuchsia-700 text-white text-xs font-semibold shadow-sm hover:shadow-md transition-all"
            aria-label="Cerrar sesión"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              ><path d="M15 3h4a2 2 0 0 1 2 2v4"></path><path d="M14 10 21 3"
              ></path><path d="M5 7v11a1 1 0 0 0 1 1h11"></path></svg
            >
            Salir
          </a>
        </nav>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-button"
          class="md:hidden p-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
          aria-label="Abrir menú de navegación"
          aria-expanded="false"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="4" x2="20" y1="12" y2="12"></line>
            <line x1="4" x2="20" y1="6" y2="6"></line>
            <line x1="4" x2="20" y1="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Mobile menu -->
      <div
        id="mobile-menu"
        class="hidden md:hidden border-t border-brand-200 bg-white"
      >
        <nav
          class="px-4 py-3 flex flex-col gap-1"
          role="navigation"
          aria-label="Navegación móvil"
        >
          <a
            class={`px-4 py-3 rounded-lg transition-all ${
              currentPath === '/'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100'
            }`}
            href="/"
          >
            <span class="flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              Inicio
            </span>
          </a>
          <a
            class={`px-4 py-3 rounded-lg transition-all ${
              currentPath === '/asientos'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100'
            }`}
            href="/asientos"
          >
            <span class="flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
                ></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" x2="8" y1="13" y2="13"></line>
                <line x1="16" x2="8" y1="17" y2="17"></line>
                <line x1="10" x2="8" y1="9" y2="9"></line>
              </svg>
              Asientos
            </span>
          </a>
          <a
            class={`px-4 py-3 rounded-lg transition-all ${
              currentPath === '/reportes'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100'
            }`}
            href="/reportes"
          >
            <span class="flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="12" x2="12" y1="20" y2="10"></line>
                <line x1="18" x2="18" y1="20" y2="4"></line>
                <line x1="6" x2="6" y1="20" y2="16"></line>
              </svg>
              Reportes
            </span>
          </a>
          <a
            class={`px-4 py-3 rounded-lg transition-all ${
              currentPath === '/compras'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100'
            }`}
            href="/compras"
          >
            <span class="flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path
                  d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
                ></path>
              </svg>
              Compras
            </span>
          </a>
          <a
            class={`px-4 py-3 rounded-lg transition-all ${
              currentPath === '/libro-diario'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100'
            }`}
            href="/libro-diario"
          >
            <span class="flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"
                ></path>
              </svg>
              Libro Diario
            </span>
          </a>
          <a
            class={`px-4 py-3 rounded-lg transition-all ${
              currentPath === '/libro-mayor'
                ? 'bg-brand-100 text-brand-700 font-semibold'
                : 'text-gray-700 hover:bg-gray-100'
            }`}
            href="/libro-mayor"
          >
            <span class="flex items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
              Libro Mayor
            </span>
          </a>
        </nav>
      </div>
    </header>
    <main class="flex-1 max-w-7xl mx-auto px-4 md:px-8 pt-24 pb-10 w-full">
      <InitStores client:only="react" />
      <slot />
    </main>
    <footer class="mt-auto border-t-2 border-brand-200 bg-white">
      <div class="max-w-7xl mx-auto px-4 md:px-8 py-6">
        <div
          class="flex flex-col md:flex-row items-center justify-between gap-3 text-xs text-gray-600"
        >
          <div class="flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-brand-600"
            >
              <rect width="20" height="14" x="2" y="7" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            <span>
              © {year}
              <span class="font-semibold text-brand-700">{companyName}</span>
            </span>
          </div>
          <div class="flex items-center gap-4">
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-500"
              >
                <path
                  d="M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z"
                ></path>
                <circle cx="16.5" cy="7.5" r=".5" fill="currentColor"></circle>
              </svg>
              NIT: {companyNit}
            </span>
            <span class="text-gray-500">|</span>
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-500"
              >
                <path
                  d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"
                ></path>
                <path d="M5 3v4"></path>
                <path d="M19 17v4"></path>
                <path d="M3 5h4"></path>
                <path d="M17 19h4"></path>
              </svg>
              Sistema Contable Universitario
            </span>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // Mobile menu toggle
      const menuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');

      menuButton?.addEventListener('click', () => {
        const isHidden = mobileMenu?.classList.contains('hidden');
        if (isHidden) {
          mobileMenu?.classList.remove('hidden');
          menuButton?.setAttribute('aria-expanded', 'true');
        } else {
          mobileMenu?.classList.add('hidden');
          menuButton?.setAttribute('aria-expanded', 'false');
        }
      });

      // Close mobile menu when clicking outside
      document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (!menuButton?.contains(target) && !mobileMenu?.contains(target)) {
          mobileMenu?.classList.add('hidden');
          menuButton?.setAttribute('aria-expanded', 'false');
        }
      });

      // Close mobile menu on navigation
      mobileMenu?.querySelectorAll('a').forEach((link) => {
        link.addEventListener('click', () => {
          mobileMenu?.classList.add('hidden');
          menuButton?.setAttribute('aria-expanded', 'false');
        });
      });
    </script>
  </body>
</html>
